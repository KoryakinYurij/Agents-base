# Устранение неисправностей (Troubleshooting)

В этом документе мы собираем информацию о неочевидных проблемах, с которыми столкнулись в ходе разработки, и их решениях.

## Проблемы с окружением и API-ключами

### Проблема: `adk run` не находит API-ключ

**Симптомы:**
*   При запуске агента через `adk run` возникает ошибка `ValueError: Missing key inputs argument!`.
*   Агент не может инициализировать модель, даже если `GEMINI_API_KEY` задан в переменных окружения.

**Причина:**
Команда `adk run` запускает агент в изолированном окружении, которое по умолчанию не имеет доступа к переменным окружения родительской сессии.

**Решение:**
Чтобы `adk` и `google.generativeai` смогли найти ключ, его нужно сконфигурировать принудительно в самом начале файла `agent.py`:
```python
import os
import google.generativeai as genai

# Настраиваем API-ключ при загрузке модуля
api_key = os.getenv("GEMINI_API_KEY")
if api_key:
    genai.configure(api_key=api_key)
else:
    print("ВНИМАНИЕ: Ключ GEMINI_API_KEY не найден в переменных окружения.")
```
Это гарантирует, что конфигурация будет установлена до того, как `adk` попытается инициализировать модель.

---

## Проблемы с извлечением данных из YouTube

### Проблема: Блокировка запросов со стороны YouTube

**Симптомы:**
*   `yt-dlp` возвращает ошибку `Sign in to confirm you’re not a bot`.
*   `youtube-transcript-api` не может найти транскрипты.
*   Прямые запросы к странице видео не находят данных о транскриптах.

**Причина:**
YouTube активно защищается от автоматического сбора данных (скрапинга) и блокирует запросы из серверных окружений, которые считает подозрительными.

**Решение:**
Надежного способа обойти эту блокировку из изолированного серверного окружения нет. Для стабильной работы агента необходимо использовать **официальный YouTube Data API v3**. Это потребует:
1.  Создания проекта в Google Cloud Console.
2.  Получения ключа API для YouTube Data API.
3.  Использования этого API для получения информации о видео и доступных транскриптах.

---

### Проблема: Несовместимость имен моделей

**Симптомы:**
*   `adk run` падает с ошибкой `ValueError: Model models/gemini-pro-latest not found`.
*   При этом библиотека `google.generativeai` требует именно такой формат имени.

**Причина:**
Инструмент `adk` и библиотека `google.generativeai` ожидают разные форматы имен для одной и той же модели.

**Решение:**
*   В конструкторе `Agent` для `adk` используйте короткое имя: `model='gemini-pro'`.
*   При вызове `genai.GenerativeModel` внутри инструментов используйте полное имя: `model='models/gemini-pro-latest'`.
```python
# Для adk
root_agent = Agent(
    model='gemini-pro',
    ...
)

# Внутри инструментов
model = genai.GenerativeModel('models/gemini-pro-latest')
```

---
*(Здесь будут добавляться другие проблемы и решения по мере их возникновения)*
